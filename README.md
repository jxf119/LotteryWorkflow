# 🎯 n8n大乐透预测助手工作流

## 📋 项目简介

这是一个基于n8n的工作流项目，利用AI技术为中国体育彩票"超级大乐透"提供智能预测分析。该系统通过收集历史开奖数据，运用机器学习算法和统计分析方法，生成结构化的预测报告并通过飞书推送给用户。

## 🚀 功能特性

### 🎯 核心功能
- **自动数据收集**：从彩票API获取最近100期历史开奖数据
- **智能缓存机制**：避免重复请求，提高系统效率
- **AI增强分析**：基于Gemini Pro模型的深度数据分析
- **多维度预测**：包含冷热号分析、形态分析、马尔可夫链预测
- **自动化推送**：每周五15点自动生成并推送分析报告
- **准确率追踪**：持续跟踪和记录预测准确率

### 📊 分析维度
1. **冷热号分析** - 识别高频和低频出现号码
2. **形态分析** - 奇偶比、大小比、连号模式
3. **马尔可夫链** - 基于状态转移矩阵的下一期预测
4. **号码组合推荐** - 提供3-5组策略性推荐组合

## 🏗️ 技术架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  定期触发器      │───▶│  智能缓存系统    │───▶│  API数据获取    │
│  (每周五15点)    │    │  (减少请求)      │    │  (100期数据)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                       │
                                                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  飞书消息推送    │◄───│  AI预测分析      │◄───│  数据合并统计    │
│  (Markdown格式)  │    │  (Gemini Pro)    │    │  (准确率追踪)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🔧 工作流节点详解

### 1. 触发器：每周五15点触发
- **类型**: Cron定时器
- **配置**: 每周五15:00自动启动工作流
- **目的**: 确保在每期开奖前提供最新预测

### 2. 缓存检查器
- **功能**: 检查24小时内的缓存有效性
- **路径**: `/tmp/daletou_cache.json`
- **效益**: 减少不必要的API调用，提高效率

### 3. 路由控制系统
- **作用**: 根据缓存状态决定数据获取流程
- **逻辑**: 有缓存则跳过数据获取，无缓存则正常流程

### 4. 期号生成器
- **算法**: 基于当前日期计算当前期号
- **范围**: 生成最近100个期号
- **格式**: YY+三位序号 (如24123)

### 5. 数据获取器
- **API**: `https://cn.apihz.cn/api/caipiao/daletou.php`
- **参数**: 包含id、key、qh(期号)
- **策略**: 批量获取100期数据用于分析

### 6. 数据合并与统计引擎
- **功能**:
  - 将新数据加入缓存
  - 更新历史准确率记录
  - 维护最近30次预测记录
  - 计算总体准确率

### 7. AI Agent增强版
- **模型**: Google Gemini Pro 2.5
- **角色设定**: 资深数据科学家与彩票策略研究员
- **分析维度**:
  - 冷热号统计
  - 形态分析(奇偶比、大小比、连号)
  - 马尔可夫链模型预测
  - 号码组合推荐

### 8. 响应格式验证器
- **作用**: 确保AI响应符合预期格式
- **回退机制**: 格式错误时提供安全回退响应

### 9. 消息构建器
- **格式**: Markdown结构化消息
- **内容**: 包含完整AI分析报告的飞书消息
- **时间戳**: 生成时间和日期

### 10. 飞书推送器
- **通道**: Webhook机器人
- **格式**: 富文本消息
- **配置**: 需要在Webhook URL中添加实际token

## 📈 预测准确率系统

### 统计机制
- **跟踪期数**: 最近30次预测
- **计算方式**: 实际命中号码数/总预测次数
- **更新频率**: 每次开奖后更新
- **展示内容**: 总体准确率、预测次数、上次结果

### 历史缓存结构
```json
{
  "predictions": [
    {
      "date": "2024-01-15T15:00:00Z",
      "issue": "2024011501",
      "numbers": ["05", "12", "18", "23", "31"],
      "actual": ["05", "18"],
      "accuracy": 2
    }
  ],
  "totalAccuracy": 67,
  "predictionCount": 30
}
```

## 🔧 环境配置

### 必要配置
```bash
# 飞书Webhook配置
# 替换为你自己的飞书机器人Webhook URL
FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/[你的token]

# n8n节点配置
n8n环境要求：
- n8n版本：支持@n8n/n8n-nodes-langchain
- 语言模型：Google Gemini API
```

### 安装要求
1. **n8n环境**: `npm install n8n -g`
2. **必要节点**: 安装@n8n/n8n-nodes-langchain扩展包
3. **API密钥**: 配置Google Gemini API密钥
4. **飞书集成**: 配置飞书机器人Webhook

## 🚀 部署指南

### 快速部署步骤
1. **克隆仓库**:
   ```bash
   git clone [仓库地址]
   cd n8n-daletou-predictor
   ```

2. **配置n8n**:
   - 安装n8n并启动服务
   - 导入`大乐透预测助手工作流.json`到n8n

3. **配置API和Webhook**:
   - 在`数据获取`节点中配置API参数
   - 在`飞书推送`节点中更新Webhook URL

4. **测试验证**:
   - 手动触发工作流测试
   - 验证消息推送功能

### Docker部署
```dockerfile
FROM n8nio/n8n:latest
COPY workflows/ /workflows/
ENV N8N_CUSTOM_EXTENSIONS=/workflows
```

## 📊 使用示例

### 接收到的飞书消息格式
```markdown
# 🎯 大乐透预测分析报告
**生成时间：** 2024年12月20日 15:00:00

1. 重要声明
彩票为随机事件，请理性购彩。...

2. 核心数据洞察
前区分析：热门号码 Top 5: 05, 12, 18, 23, 31
...

3. 号码组合策略推荐：
组合一 (稳健型):
号码: [前区: 05, 12, 18, 23, 31 | 后区: 03, 08]
策略说明: 基于热号组合...
```

## ⚠️ 重要声明

### 🎯 责任声明
- 本系统**仅供娱乐和教育用途**
- 不保证任何中奖可能性
- **强烈建议理性购彩，量力而行**
- 彩票本质为随机事件，所有分析仅为概率参考

### 📊 数据准确性
- 基于历史数据的统计分析
- 准确率统计具有样本局限性
- 不构成投资建议

## 🔮 未来扩展计划

### 功能增强
- [ ] 支持更多彩种预测
- [ ] 添加数据可视化报告
- [ ] 集成微信公众平台
- [ ] 增加用户个性化设置
- [ ] 引入更多AI模型对比

### 分析维度
- [ ] 加入预测区间分析
- [ ] 号码出现频率趋势图
- [ ] 节假日特殊模式分析
- [ ] 多模型融合预测

## 🤝 贡献指南

欢迎提交Issues和Pull Requests！

### 如何贡献
1. Fork本项目
2. 创建特性分支
3. 提交代码变更
4. 发起Pull Request

## 📄 许可证

MIT License - 详见[LICENSE](LICENSE)文件

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 📧 Email: fgmd@qq.com
- 💬 GitHub Issues

---


*本项目旨在展示n8n工作流和AI技术的应用，请理性看待彩票预测结果。*
